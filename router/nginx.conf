server {
  # Do not merge slashes in URL paths 
  # e.g http://hub.stenci.la/open/github://user/repo/
  merge_slashes off;

  location /internal/broker {
    # Internal proxy URL to broker to be used with `X-Accel-Redirect`
    # to restrict access.
    internal;
    proxy_pass ${BROKER_URL};
  }

  location / {
    # Proxy everything else to director
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Scheme $scheme;
    proxy_pass ${DIRECTOR_URL};
  }
}

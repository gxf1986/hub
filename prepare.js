/**
 * Script to generate Python files from Javascript
 * dependencies.
 *
 * Run both BEFORE the package is packed and published, and on
 * local npm install without any arguments.
 *
 * The generated files should be:
 *
 *  - committed so that Python developers, and deployments,
 *    don't need to run `npm install` first.
 *
 *  - should be added to the release assets list in `package.json`
 *    so that they get automatically committed as part of
 *    each release.
 */

const fs = require("fs");
const path = require("path");

thema();

/**
 * Generate `director/assets/thema.py` with the version of
 * Thema to use and the names of themes available.
 */
function thema() {
  const json = fs.readFileSync(
    path.join(
      require.resolve("@stencila/thema"),
      "..",
      "..",
      "..",
      "package.json"
    ),
    "utf8"
  )
  const version = JSON.parse(json).version

  const themes = require("@stencila/thema").themes

  fs.writeFileSync(
    path.join(__dirname, "director", "assets", "thema.py"),
    `# Generated by ${path.basename(
      __filename
    )}. Commit this file, but do not edit it.

# fmt: off

version = "${version}"
themes = ${JSON.stringify(Object.keys(themes), null, '    ')}
`
  )
}

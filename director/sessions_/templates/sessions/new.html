{% extends 'base.html' %}
{% load static %}

{% block title %}Launch a session{% endblock %}

{% block main %}

<div id="message" class="ui icon message">
	<i class="ui circle info icon"></i>
	<div class="ui content">
		When you open a Stencila component (e.g stencil or sheet), if you don't have the right session running already we'll automatically launch one for you. So you don't need to launch a session unless you want a specific type (or to play around under the hood!)
	</div>
</div>

{% if sessions|length %}
	<table class="ui celled table">
		<thead>
			<tr style="font-size: 1.2em">
				<th colspan="4">Your active sessions</th>
			</tr>
			<tr>
				<th>ID</th>
				<th>Type</th>
				<th>Image</th>
				<th>Started</th>
			</tr>
		</thead>
		<tbody>
		{% for session in sessions %}
			<tr>
				<td><a href="{{ session.url }}">{{ session.id }}</a></td>
				<td>{{ session.type.name }}</td>
				<td title="{{ session.image_type.name }}:{{ session.image_type.tag }}">{{ session.image_type.display_name }}</td>
				<td>{{ session.started }}</td>
			</tr>
		{% endfor %}
		</tbody>
	</table>
{% endif %}

<div id="types" class="ui cards">
	{% for type in types %}
		<div class="ui card">
			<div class="ui content">
				<div class="ui header">
					{{ type.name }}
				</div>
				<div class="ui">
					{{ type.description }}
				</div>
			</div>
			<div class="ui extra content">
				{# In extra content so that line up regardless of length of description #}
				<table class="ui definition table">
					<tbody>
						<tr>
						  <td class="two wide column">Memory</td>
						  <td>{{ type.ram }} GB</td>
						</tr>
						<tr>
						  <td>CPU</td>
						  <td>{{ type.cpu }} GHz</td>
						</tr>
						<tr>
						  <td>Network</td>
						  <td>{{ type.network }} GB</td>
						</tr>
						<tr>
						  <td>Timeout</td>
						  <td>{{ type.timeout }} mins</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="ui bottom attached segment">
				<div class="launch ui green fluid button" data-type="{{ type.id }}">
					<i class="ui rocket icon"></i>
					Launch
				</div>
				<select class="image ui search selection fluid dropdown">
					{% for image in images %}
						<option value="{{ image.name }}">{{ image.display_name }}</option>
					{% endfor %}
				</select>
			</div>
		</div>
	{% endfor %}
	<div class="custom ui card">
		<div class="ui content">
			<div class="ui header">
				Custom
			</div>
			<div class="ui">
				Not seeing the session configuration you need? Want different image types? 
				Let us know and we'll be in touch regarding setting a custom session type.
			</div>
		</div>
		<div class="ui extra content">
			{# In extra content so that line up regardless of length of description #}
			<form class="ui form">
			<div class="ui right labeled input">
			  <label class="ui label">Memory</label>
			  <input type="ram">
			  <label class="ui basic label">GB</label>
			</div>
			<div class="ui right labeled input">
			  <label class="ui label">CPU</label>
			  <input type="cpu">{{ type.cpu }}
			  <label class="ui basic label">GB</label>
			</div>
			<div class="ui right labeled input">
			  <label class="ui label">Network</label>
			  <input type="network">{{ type.network }} GB</td>
			</div>
			<div class="ui right labeled input">
			  <label class="ui label">Timeout</label>
			  <input type="timeout">{{ type.timeout }} mins</td>
			</div>
		</div>
		<div class="ui bottom attached segment">
			<div class="ui green fluid button">
				<i class="ui send icon"></i>
				One like this please!
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$('.launch.button').click(function(event){
		var $button = $(this);
		var $image = $button.parent().find('select');
		Stencila.post('sessions/new',{
			type: $button.data('type'),
			image: $image.val(),
		}).done(function(data, status, xhr){
			if (xhr.status==201) {
				window.location = xhr.getResponseHeader("Location");
			}
		}).always(function(){
			$button
				.empty()
				.append('<i class="ui loading spinner icon"></i>')
				.append('Lift off!')
				.addClass('orange disabled')
				.off();
		});
	});

	$('.image.select').dropdown();

	$('.custom.card .button').click(function(event) {
		var $button = $(this);
		Stencila.post('events',{
			name: 'sessions-custom-requested',
			data: {

			}
		}).always(function(){
			$button
				.text('Thanks for feedback! We`ll be in touch')
				.addClass('disabled')
				.off();
		});
	});

	$('[title]').popup();
</script>
{% endblock %}
